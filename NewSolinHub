--// ====== SERVIZI ======
local Players            = game:GetService("Players")
local ReplicatedStorage  = game:GetService("ReplicatedStorage")
local Workspace          = game:GetService("Workspace")
local TeleportService    = game:GetService("TeleportService")
local RunService         = game:GetService("RunService")
local player             = Players.LocalPlayer

-- Remote attacchi
local attackRemote = ReplicatedStorage:WaitForChild("jdskhfsIIIllliiIIIdchgdIiIIIlIlIli")

-- Cartelle utili
local map           = Workspace:WaitForChild("MAP")
local dummiesFolder = map:WaitForChild("dummies")
local folder5k      = map:FindFirstChild("5k_dummies")

local bossesList = { "ROCKY","Griffin","BOOSBEAR","BOSSDEER","CENTAUR","CRABBOSS","DragonGiraffe","LavaGorilla" }

--// ====== RAYFIELD UI ======
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Solin Hub Test",
    LoadingTitle = "Script Hub",
    LoadingSubtitle = "By: Solin",
    ConfigurationSaving = { Enabled = true, FolderName = "SolinHubConfig", FileName = "MainConfig" },
    Discord = { Enabled = true, Invite = "YAgqvFAC6E", RememberJoins = true },
    KeySystem = true,
    KeySettings = {
        Title = "Solin Hub | Key System ðŸ”‘",
        Subtitle = "Enter the key to continue",
        Note = "Get the key from our Discord.gg/n7AucXH96x",
        FileName = "SolinHubKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"FreeAccess57"}
    }
})

--// ====== UTILS ======
local function myChar()
    local c = player.Character or player.CharacterAdded:Wait()
    return c, c:WaitForChild("Humanoid"), c:WaitForChild("HumanoidRootPart")
end

local function getAliveHumanoid(model)
    if not model then return nil end
    local hum = model:FindFirstChildOfClass("Humanoid")
    if hum and hum.Health > 0 then return hum end
    return nil
end

local function getClosestPlayer(fromRoot, range)
    local best, dist = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player and p.Character then
            local hrp = p.Character:FindFirstChild("HumanoidRootPart")
            local hum = getAliveHumanoid(p.Character)
            if hrp and hum then
                local d = (fromRoot.Position - hrp.Position).Magnitude
                if d < dist and d <= (range or 9999) then
                    best, dist = p, d
                end
            end
        end
    end
    return best
end

--// ====== LOOP FLAGS ======
local AF = { coins=false, bosses=false, dummies=false, dummies5k=false }
local PVP = { killAura=false, orbit=false, autoTP=false }
local currentTarget
local orbitSpeed = 35
local orbitRadius = 5
local orbitHeight = -4
local superFastDelay = 0.03

--// ====== AUTO FARM FUNZIONI ======
local function autoCoins()
    while AF.coins do
        local events = ReplicatedStorage:FindFirstChild("Events")
        local coinEvent = events and events:FindFirstChild("CoinEvent")
        if coinEvent then coinEvent:FireServer() end
        task.wait(1)
    end
end

-- trova dummy
local function findDummy()
    for _, d in ipairs(dummiesFolder:GetChildren()) do
        local hum = getAliveHumanoid(d)
        if d.Name == "Dummy" and hum then return hum end
    end
end

local function find5kDummy()
    if folder5k and folder5k.Parent then
        for _, d in ipairs(folder5k:GetChildren()) do
            local hum = getAliveHumanoid(d)
            if hum then return hum end
        end
    end
end

-- Attack Dummy + Fireball + Lightning
local function attackDummyLoop()
    local remote = ReplicatedStorage:WaitForChild("SkillsInRS"):WaitForChild("RemoteEvent")
    while AF.dummies do
        local hum = findDummy()
        if hum then
            local hrp = hum.Parent:FindFirstChild("HumanoidRootPart")
            local pos = hrp and hrp.Position or Vector3.new()

            -- Hit base
            attackRemote:FireServer(hum, 2)
            -- Fireball
            remote:FireServer(pos, "NewFireball")
            -- Lightning
            remote:FireServer(pos, "NewLightningball")
        end
        task.wait(0.05)
    end
end

-- Attack 5k Dummy + Fireball + Lightning
local function attack5kDummyLoop()
    local remote = ReplicatedStorage:WaitForChild("SkillsInRS"):WaitForChild("RemoteEvent")
    while AF.dummies5k do
        local hum = find5kDummy()
        if hum then
            local hrp = hum.Parent:FindFirstChild("HumanoidRootPart")
            local pos = hrp and hrp.Position or Vector3.new()

            -- Hit base
            attackRemote:FireServer(hum, 2)
            -- Fireball
            remote:FireServer(pos, "NewFireball")
            -- Lightning
            remote:FireServer(pos, "NewLightningball")
        end
        task.wait(0.05)
    end
end

local function farmBosses()
    while AF.bosses do
        local npcFolder = Workspace:FindFirstChild("NPC")
        if npcFolder then
            for _, name in ipairs(bossesList) do
                local boss = npcFolder:FindFirstChild(name)
                local hum = getAliveHumanoid(boss)
                if hum then attackRemote:FireServer(hum, 5) end
            end
        end
        task.wait(1)
    end
end

--// ====== PVP FUNZIONI ======
local function orbitAndHit(targetPlr)
    while PVP.orbit do
        if not targetPlr or not targetPlr.Character then break end
        local _, _, myHRP = myChar()
        local trgHRP = targetPlr.Character:FindFirstChild("HumanoidRootPart")
        local trgHum = getAliveHumanoid(targetPlr.Character)
        if not myHRP or not trgHRP or not trgHum then break end

        local t = tick()*orbitSpeed
        local offset = Vector3.new(math.cos(t)*orbitRadius, orbitHeight, math.sin(t)*orbitRadius)
        myHRP.CFrame = CFrame.new(trgHRP.Position + offset)

        attackRemote:FireServer(trgHum, 5)
        task.wait(superFastDelay)
    end
end

local function autoTPLoop()
    while PVP.autoTP do
        if currentTarget and currentTarget.Character then
            local _, _, myHRP = myChar()
            local trgHRP = currentTarget.Character:FindFirstChild("HumanoidRootPart")
            if myHRP and trgHRP then
                myHRP.CFrame = trgHRP.CFrame * CFrame.new(0, 0, 3)
            end
        end
        task.wait(0.25)
    end
end

--// ====== TAB: MAIN ======
local TabMain = Window:CreateTab("Main âš™ï¸", 6034509995)
TabMain:CreateToggle({ Name="Auto Coins ðŸ’°", CurrentValue=false, Callback=function(v) AF.coins=v if v then task.spawn(autoCoins) end end })
TabMain:CreateToggle({ Name="Auto Dummy âš”ï¸ðŸ”¥âš¡", CurrentValue=false, Callback=function(v) AF.dummies=v if v then task.spawn(attackDummyLoop) end end })
TabMain:CreateToggle({ Name="Auto Dummy 5k âš”ï¸ðŸ”¥âš¡", CurrentValue=false, Callback=function(v) AF.dummies5k=v if v then task.spawn(attack5kDummyLoop) end end })
TabMain:CreateToggle({ Name="Auto Bosses ðŸ‰", CurrentValue=false, Callback=function(v) AF.bosses=v if v then task.spawn(farmBosses) end end })

--// ====== TAB: PVP ======
local TabPVP = Window:CreateTab("PvP ðŸ›¡ï¸", 6034509995)
TabPVP:CreateToggle({ Name="Kill Aura âš”ï¸", CurrentValue=false, Callback=function(v) PVP.killAura=v end })
TabPVP:CreateToggle({ Name="Orbit Player ðŸ”„", CurrentValue=false, Callback=function(v)
    PVP.orbit=v
    if v and not currentTarget then
        local _, _, myHRP = myChar()
        currentTarget = getClosestPlayer(myHRP, 200)
        if currentTarget then task.spawn(function() orbitAndHit(currentTarget) end) end
    end
end })
TabPVP:CreateToggle({ Name="Auto TP to Player ðŸŒ€", CurrentValue=false, Callback=function(v)
    PVP.autoTP=v
    if v then task.spawn(autoTPLoop) end
end })

--// ====== TAB: STUFF ======
local TabStuff = Window:CreateTab("Stuff ðŸŽ", 6034509995)
TabStuff:CreateSection("Utility")
TabStuff:CreateButton({ Name="Rejoin ðŸ”„", Callback=function() TeleportService:Teleport(game.PlaceId, player) end })
TabStuff:CreateInput({
    Name="Set WalkSpeed ðŸ’¨", PlaceholderText="es. 16, 50, 100...", RemoveTextAfterFocusLost=true,
    Callback=function(text) local v=tonumber(text) if v and player.Character and player.Character:FindFirstChild("Humanoid") then player.Character.Humanoid.WalkSpeed=v end end
})

--// ====== TAB: EXTRAS ======
local TabExtras = Window:CreateTab("Extras âœ¨", 6034509995)
TabExtras:CreateSection("Gadget")

-- Chicken Shooter ðŸ”ðŸ”«
local chickenLoop = false
TabExtras:CreateToggle({
    Name = "Chicken Shooter ðŸ”ðŸ”«",
    CurrentValue = false,
    Callback = function(state)
        chickenLoop = state
        if state then
            task.spawn(function()
                local chickenEvent = ReplicatedStorage:FindFirstChild("ChickenEvent")
                local event = chickenEvent and chickenEvent:FindFirstChild("RemoteEvent")
                if not event then warn("ChickenEvent.RemoteEvent non trovato!") return end
                local args = { { action = "shoot" } }
                while chickenLoop do
                    for i = 1, 250 do event:FireServer(unpack(args)) end
                    task.wait(0.1)
                end
            end)
        end
    end
})

TabExtras:CreateButton({ Name="Free Fireball ðŸ”¥ (placeholder)", Callback=function() end })
TabExtras:CreateButton({ Name="Free Radio ðŸ“» (placeholder)", Callback=function() end })

--// ====== TAB: CLAN ======
local TabClan = Window:CreateTab("Clan ðŸ‘‘", 6034509995)
TabClan:CreateSection("Join")
local clanInput = ""
TabClan:CreateInput({ Name="Clan Name", PlaceholderText="Scrivi il nome del clan", RemoveTextAfterFocusLost=false, Callback=function(text) clanInput=text end })
TabClan:CreateButton({
    Name="Join Clan",
    Callback=function()
        Rayfield:Notify({ Title="Clan", Content=(clanInput~="" and ("Tentativo join a: "..clanInput)) or "Inserisci un nome clan", Duration=3 })
    end
})

--// ====== SAFE CHECK ======
RunService.Stepped:Connect(function()
    if PVP.orbit and (not currentTarget or not currentTarget.Character or not getAliveHumanoid(currentTarget.Character)) then
        local _, _, myHRP = myChar()
        currentTarget = getClosestPlayer(myHRP, 200)
        if currentTarget then task.spawn(function() orbitAndHit(currentTarget) end) end
    end
end)
