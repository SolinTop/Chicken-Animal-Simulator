--// ====== SERVIZI ======
local Players            = game:GetService("Players")
local ReplicatedStorage  = game:GetService("ReplicatedStorage")
local Workspace          = game:GetService("Workspace")
local TeleportService    = game:GetService("TeleportService")
local RunService         = game:GetService("RunService")
local player             = Players.LocalPlayer

-- Remote attacchi (nome preso dal tuo gioco)
local attackRemote = ReplicatedStorage:WaitForChild("jdskhfsIIIllliiIIIdchgdIiIIIlIlIli")

-- Cartelle utili
local map           = Workspace:WaitForChild("MAP")
local dummiesFolder = map:WaitForChild("dummies")
local folder5k      = map:FindFirstChild("5k_dummies") -- pu√≤ non esistere in alcune mappe, gestito sotto

local bossesList = { "ROCKY","Griffin","BOOSBEAR","BOSSDEER","CENTAUR","CRABBOSS","DragonGiraffe","LavaGorilla" }

--// ====== RAYFIELD UI ======
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Solin Hub üëë",
    LoadingTitle = "Script Hub",
    LoadingSubtitle = "By: Solin",
    ConfigurationSaving = { Enabled = true, FolderName = "SolinHubConfig", FileName = "MainConfig" },
    Discord = { Enabled = true, Invite = "YAgqvFAC6E", RememberJoins = true },
    KeySystem = true,
    KeySettings = {
        Title = "Solin Hub | Key System üîë",
        Subtitle = "Enter the key to continue",
        Note = "Get the key from our Discord.gg/n7AucXH96x",
        FileName = "SolinHubKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"FreeAccess57"}
    }
})

--// ====== UTILS ======
local function myChar()
    local c = player.Character or player.CharacterAdded:Wait()
    return c, c:WaitForChild("Humanoid"), c:WaitForChild("HumanoidRootPart")
end

local function getAliveHumanoid(model)
    if not model then return nil end
    local hum = model:FindFirstChildOfClass("Humanoid")
    if hum and hum.Health > 0 then return hum end
    return nil
end

local function getClosestPlayer(fromRoot, range)
    local best, dist = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player and p.Character then
            local hrp = p.Character:FindFirstChild("HumanoidRootPart")
            local hum = getAliveHumanoid(p.Character)
            if hrp and hum then
                local d = (fromRoot.Position - hrp.Position).Magnitude
                if d < dist and d <= (range or 9999) then
                    best, dist = p, d
                end
            end
        end
    end
    return best
end

--// ====== LOOP FLAGS ======
local AF = { coins=false, dummies=false, dummies5k=false, bosses=false }
local PVP = { killAura=false, orbit=false, autoTP=false }
local currentTarget -- Player target per PvP
local orbitSpeed = 35
local orbitRadius = 5
local orbitHeight = -4 -- ‚Äúsotto‚Äù al bersaglio come richiesto
local superFastDelay = 0.03

--// ====== AUTO FARM FUNZIONI ======
local function autoCoins()
    while AF.coins do
        local events = ReplicatedStorage:FindFirstChild("Events")
        local coinEvent = events and events:FindFirstChild("CoinEvent")
        if coinEvent then
            coinEvent:FireServer()
        end
        task.wait(1)
    end
end

local function findAnyDummy()
    for _, d in ipairs(dummiesFolder:GetChildren()) do
        local hum = getAliveHumanoid(d)
        if d.Name == "Dummy" and hum then
            return hum
        end
    end
end

local function find5kDummyHum()
    -- fallback 1: cartella 5k_dummies
    if folder5k and folder5k.Parent then
        for _, d in ipairs(folder5k:GetChildren()) do
            local hum = getAliveHumanoid(d)
            if hum then return hum end
        end
    end
    -- fallback 2: nome specifico (esempio che mi hai dato Dummy2)
    local ok, path = pcall(function()
        return map:WaitForChild("5k_dummies", 1):WaitForChild("Dummy2", 1):WaitForChild("Humanoid", 1)
    end)
    if ok and path and path.Parent and path.Health > 0 then
        return path
    end
    return nil
end

local function farmDummies()
    while AF.dummies do
        local hum = findAnyDummy()
        if hum then attackRemote:FireServer(hum, 6) end
        task.wait(0.1)
    end
end

local function farm5kDummies()
    while AF.dummies5k do
        local hum = find5kDummyHum()
        if hum then attackRemote:FireServer(hum, 6) end
        task.wait(0.1)
    end
end

local function farmBosses()
    while AF.bosses do
        local npcFolder = Workspace:FindFirstChild("NPC")
        if npcFolder then
            for _, name in ipairs(bossesList) do
                local boss = npcFolder:FindFirstChild(name)
                local hum = getAliveHumanoid(boss)
                if hum then
                    attackRemote:FireServer(hum, 5)
                end
            end
        end
        task.wait(1)
    end
end

--// ====== PVP FUNZIONI ======
local function orbitAndHit(targetPlr)
    while PVP.orbit do
        if not targetPlr or not targetPlr.Character then break end
        local myC, myHum, myHRP = myChar()
        local trgHRP = targetPlr.Character:FindFirstChild("HumanoidRootPart")
        local trgHum = getAliveHumanoid(targetPlr.Character)
        if not myHRP or not trgHRP or not trgHum then break end

        -- Posizionamento orbit (velocissimo, sotto al player)
        local t = tick()*orbitSpeed
        local offset = Vector3.new(math.cos(t)*orbitRadius, orbitHeight, math.sin(t)*orbitRadius)
        myHRP.CFrame = CFrame.new(trgHRP.Position + offset)

        -- Kill Aura velocissima sul target
        attackRemote:FireServer(trgHum, 5)

        task.wait(superFastDelay)
    end
end

local function autoTPLoop()
    while PVP.autoTP do
        if currentTarget and currentTarget.Character then
            local _, _, myHRP = myChar()
            local trgHRP = currentTarget.Character:FindFirstChild("HumanoidRootPart")
            if myHRP and trgHRP then
                myHRP.CFrame = trgHRP.CFrame * CFrame.new(0, 0, 3)
            end
        end
        task.wait(0.25)
    end
end

--// ====== TAB: MAIN (Auto Farm) ======
local TabMain = Window:CreateTab("Main ‚öôÔ∏è", 6034509995)

local colMainLeft  = TabMain:CreateSection("Farm ‚Ä¢ Toggle")
local colMainRight = TabMain:CreateSection("Farm ‚Ä¢ Opzioni")

TabMain:CreateToggle({
    Name = "Auto Coins üí∞",
    CurrentValue = false,
    Callback = function(v)
        AF.coins = v
        if v then task.spawn(autoCoins) end
    end
})

TabMain:CreateToggle({
    Name = "Auto Dummies (Trainee) ‚öîÔ∏è",
    CurrentValue = false,
    Callback = function(v)
        AF.dummies = v
        if v then task.spawn(farmDummies) end
    end
})

TabMain:CreateToggle({
    Name = "Auto Dummies 5k ‚öîÔ∏è",
    CurrentValue = false,
    Callback = function(v)
        AF.dummies5k = v
        if v then task.spawn(farm5kDummies) end
    end
})

TabMain:CreateToggle({
    Name = "Auto Bosses üêâ",
    CurrentValue = false,
    Callback = function(v)
        AF.bosses = v
        if v then task.spawn(farmBosses) end
    end
})

-- Chicken Shooter üêîüî´
local chickenLoop = false
TabExtras:CreateToggle({
    Name = "Chicken Shooter üêîüî´",
    CurrentValue = false,
    Callback = function(state)
        chickenLoop = state
        if state then
            task.spawn(function()
                local replicatedStorage = game:GetService("ReplicatedStorage")
                local chickenEvent = replicatedStorage:FindFirstChild("ChickenEvent")
                local event = chickenEvent and chickenEvent:FindFirstChild("RemoteEvent")
                if not event then warn("ChickenEvent.RemoteEvent non trovato!") return end

                local args = { { action = "shoot" } }
                while chickenLoop do
                    for i = 1, 250 do event:FireServer(unpack(args)) end
                    task.wait(0.1)
                end
            end)
        end
    end
})


--// ====== TAB: PVP ======
local TabPvP = Window:CreateTab("PvP üõ°Ô∏è", 6034509995)

local secPvPLeft  = TabPvP:CreateSection("Combat")
local secPvPRight = TabPvP:CreateSection("Target / Movement")

-- Target dropdown (non ricarica la UI, solo setta la var)
local function refreshTargetList()
    local names = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then table.insert(names, p.Name) end
    end
    return names
end

local targetDropdown = TabPvP:CreateDropdown({
    Name = "Select Target üéØ",
    Options = refreshTargetList(),
    CurrentOption = {},
    MultipleOptions = false,
    Callback = function(chosen)
        local name = (typeof(chosen)=="table" and chosen[1]) or chosen
        currentTarget = Players:FindFirstChild(name)
    end
})

-- Aggiorna lista se join/leave
Players.PlayerAdded:Connect(function()
    task.wait(0.5)
    targetDropdown:Refresh(refreshTargetList(), true)
end)
Players.PlayerRemoving:Connect(function()
    task.wait(0.5)
    targetDropdown:Refresh(refreshTargetList(), true)
    if currentTarget and not Players:FindFirstChild(currentTarget.Name) then
        currentTarget = nil
    end
end)

-- Orbit + Kill Aura velocissima (toggle unico)
TabPvP:CreateToggle({
    Name = "Orbit + Kill Aura ‚ö°",
    CurrentValue = false,
    Callback = function(v)
        PVP.orbit = v
        if v then
            if not currentTarget then
                -- se non hai selezionato target, prendo il pi√π vicino
                local _, _, myHRP = myChar()
                currentTarget = getClosestPlayer(myHRP, 200)
            end
            if currentTarget then
                task.spawn(function() orbitAndHit(currentTarget) end)
            end
        end
    end
})

-- TP istantaneo al target (one-shot)
TabPvP:CreateButton({
    Name = "TP to Target üåÄ",
    Callback = function()
        if currentTarget and currentTarget.Character then
            local _, _, myHRP = myChar()
            local trgHRP = currentTarget.Character:FindFirstChild("HumanoidRootPart")
            if myHRP and trgHRP then
                myHRP.CFrame = trgHRP.CFrame * CFrame.new(0, 0, 3)
            end
        end
    end
})

-- Auto TP (segue il target)
TabPvP:CreateToggle({
    Name = "Auto TP (Follow) üîÅ",
    CurrentValue = false,
    Callback = function(v)
        PVP.autoTP = v
        if v then task.spawn(autoTPLoop) end
    end
})

-- Slider raggio/speed/altezza per l‚Äôorbit (controlli rapidi)
TabPvP:CreateSlider({
    Name = "Orbit Radius",
    Range = {2, 15},
    Increment = 1,
    CurrentValue = orbitRadius,
    Callback = function(val) orbitRadius = val end
})
TabPvP:CreateSlider({
    Name = "Orbit Speed",
    Range = {10, 80},
    Increment = 1,
    CurrentValue = orbitSpeed,
    Callback = function(val) orbitSpeed = val end
})
TabPvP:CreateSlider({
    Name = "Orbit Height (sotto = -)",
    Range = {-10, 10},
    Increment = 1,
    CurrentValue = orbitHeight,
    Callback = function(val) orbitHeight = val end
})

--// ====== TAB: STUFF ======
local TabStuff = Window:CreateTab("Stuff üéÅ", 6034509995)
TabStuff:CreateSection("Utility")

TabStuff:CreateButton({
    Name = "Rejoin üîÑ",
    Callback = function()
        TeleportService:Teleport(game.PlaceId, player)
    end
})

-- Speed a scelta manuale
TabStuff:CreateInput({
    Name = "Set WalkSpeed üí®",
    PlaceholderText = "es. 16 (default), 50, 100...",
    RemoveTextAfterFocusLost = true,
    Callback = function(text)
        local v = tonumber(text)
        if v and player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = v
        end
    end
})

--// ====== EXTRA (OPZIONALI PLACEHOLDER) ======
local TabExtras = Window:CreateTab("Extras ‚ú®", 6034509995)
TabExtras:CreateSection("Gadget")
TabExtras:CreateButton({ Name = "Free Fireball üî• (placeholder)", Callback = function() end })
TabExtras:CreateButton({ Name = "Free Radio üìª (placeholder)", Callback = function() end })

--// ====== CLAN ======
local TabClan = Window:CreateTab("Clan üëë", 6034509995)
TabClan:CreateSection("Join")
local clanInput = ""
TabClan:CreateInput({
    Name = "Clan Name",
    PlaceholderText = "Scrivi il nome del clan",
    RemoveTextAfterFocusLost = false,
    Callback = function(text) clanInput = text end
})
TabClan:CreateButton({
    Name = "Join Clan",
    Callback = function()
        -- Qui dovresti inserire la tua logica di join clan (Remote/Event del gioco se esiste)
        Rayfield:Notify({
            Title = "Clan",
            Content = (clanInput ~= "" and ("Tentativo join a: "..clanInput)) or "Inserisci un nome clan",
            Duration = 3
        })
    end
})

--// ====== SICUREZZA BASICA ======
-- Se il target muore o esce, l‚Äôorbit NON manda in safe: semplicemente continua finch√© trova di nuovo il target/closest
RunService.Stepped:Connect(function()
    if PVP.orbit and (not currentTarget or not currentTarget.Character or not getAliveHumanoid(currentTarget.Character)) then
        local _, _, myHRP = myChar()
        currentTarget = getClosestPlayer(myHRP, 200)
        -- il loop orbitAndHit si fermer√† e verr√† rilanciato dal toggle se serve; qui lo rilanciamo auto
        if currentTarget then
            task.spawn(function() orbitAndHit(currentTarget) end)
        end
    end
end)
